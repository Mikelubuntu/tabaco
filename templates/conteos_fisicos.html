{% extends "base.html" %}

{% block content %}
<div class="container fade-in">
    <div class="card shadow-sm p-4 glass-card mb-4">
        <h3 class="mb-3 text-center"><i class="bi bi-list-ul"></i> Conteos en Tienda</h3>
        <form method="get" class="row g-3 mb-3">
    <div class="col-md-4">
        <label for="tienda" class="form-label">Filtrar por tienda:</label>
        <select id="tienda" name="tienda" class="form-select" onchange="this.form.submit()">
            <option value="">Todas</option>
            {% for t in tiendas %}
            <option value="{{ t }}" {% if tienda_seleccionada==t %}selected{% endif %}>{{ t }}</option>
            {% endfor %}
        </select>
    </div>
    <div class="col-md-4">
        <label for="fecha" class="form-label">Filtrar por fecha:</label>
        <input type="date" id="fecha" name="fecha" class="form-control" value="{{ fecha_seleccionada or '' }}" onchange="this.form.submit()">
    </div>
    <div class="col-md-4 text-end align-self-end">
        <a href="{{ url_for('exportar_conteos_excel', tienda=tienda_seleccionada) }}" class="btn btn-info mb-1">
            <i class="bi bi-file-earmark-excel"></i> Exportar Excel
        </a>
        <a href="{{ url_for('exportar_conteos_pdf', tienda=tienda_seleccionada) }}" class="btn btn-danger mb-1">
            <i class="bi bi-file-earmark-pdf"></i> Exportar PDF
        </a>
        <a href="{{ url_for('eliminar_todos_conteos') }}" class="btn btn-warning mb-1" onclick="return confirm('¿Seguro que quieres eliminar todos los conteos?');">
            <i class="bi bi-trash"></i> Eliminar Todos
        </a>
    </div>
</form>
        <div class="table-responsive">
            <table class="table table-striped align-middle table-hover shadow-sm">
                <thead class="table-light">
                    <tr>
                        <th>ID</th>
                        <th>Tienda</th>
                        <th>Código</th>
                        <th>Descripción</th>
                        <th>Cód. Barras</th>
                        <th>Cantidad Física</th>
                        <th>Fecha</th>
                        <th>Usuario</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                {% for c in conteos %}
                    <tr>
                        <td>{{ c.id }}</td>
                        <td>{{ c.tienda }}</td>
                        <td>{{ c.codigo }}</td>
                        <td>{{ c.descripcion }}</td>
                        <td>{{ c.cod_barras }}</td>
                        <td>{{ c.stock_fisico }}</td>
                        <td>{{ c.fecha }}</td>
                        <td>{{ c.autor or '-' }}</td>
                        <td>
                        <a href="{{ url_for('editar_conteo', id=c.id) }}" class="btn btn-primary btn-sm" title="Editar"><i class="bi bi-pencil"></i></a>
                        <a href="{{ url_for('eliminar_conteo', id=c.id) }}" class="btn btn-danger btn-sm" onclick="return confirm('¿Seguro que quieres eliminar este conteo?');" title="Eliminar"><i class="bi bi-trash"></i></a>
                        </td>

                    </tr>
                {% else %}
                    <tr>
                        <td colspan="8" class="text-center text-muted">No hay conteos registrados.</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
<style>
    .glass-card {
        background: rgba(255,255,255,0.89);
        border-radius: 16px;
        box-shadow: 0 8px 32px 0 rgba(31,38,135,0.14);
        backdrop-filter: blur(7px);
        -webkit-backdrop-filter: blur(7px);
    }
    .fade-in {
        opacity: 0;
        animation: fadeIn 0.7s forwards;
    }
    @keyframes fadeIn {
        to { opacity: 1; }
    }
    .table thead th {
        background: rgba(245,245,255,0.97);
    }
</style>
{% endblock %}
